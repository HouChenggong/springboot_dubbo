# 打开一个网页，整个过程发生了什么？

## 1. DNS解析

实现了网址到IP地址的转换

### 1.1 具体解析过程

DNS解析是一个递归查询的过程。

1. 首先在本地域名服务器中查询IP地址，如果没有找到的情况下
2. 本地域名服务器会向根域名服务器发送一个请求，如果根域名服务器也不存在该域名时
3. 本地域名会向com顶级域名服务器发送一个请求，
4. 依次类推下去。直到最后本地域名服务器得到google的IP地址并把它缓存到本地，供下次查询使用。

从上述过程中，可以看出网址的解析是一个从右向左的过程: com -> google.com -> www.google.com。但是你是否发现少了点什么，根域名服务器的解析过程呢？事实上，真正的网址是www.google.com.，并不是我多打了一个.，这个.对应的就是根域名服务器，默认情况下所有的网址的最后一位都是.，既然是默认情况下，为了方便用户，通常都会省略，浏览器在请求DNS的时候会自动加上，所有网址真正的解析过程为: . -> .com -> google.com. -> www.google.com.。

- .根域
- .com .cn .net .edu .org/gov五个顶级域
- qq.com  域名
- www.qq.com 子域名

### 1.2 DNS优化

了解了DNS的过程，可以为我们带来哪些？上文中请求到google的IP地址时，经历了8个步骤，这个过程中存在多个请求(同时存在UDP和TCP请求，为什么有两种请求方式，请自行查找)。如果每次都经过这么多步骤，是否太耗时间？如何减少该过程的步骤呢？那就是DNS缓存。

### 1.3 DNS缓存

DNS存在着多级缓存，从离浏览器的距离排序的话，有以下几种: 浏览器缓存，系统缓存，路由器缓存，IPS服务器缓存，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存。

### 1.4 DNS负载均衡

1. 不知道大家有没有思考过一个问题: DNS返回的IP地址是否每次都一样？如果每次都一样是否说明你请求的资源都位于同一台机器上面，那么这台机器需要多高的性能和储存才能满足亿万请求呢？其实真实的互联网世界背后存在成千上百台服务器，大型的网站甚至更多。

2. 大家耳熟能详的CDN(Content Delivery Network)就是利用DNS的重定向技术，DNS服务器会返回一个跟用户最接近的点的IP地址给用户，CDN节点的服务器负责响应用户的请求，提供所需的内容

## 2.TCP连接
## 3. 发送HTTP请求

HTTP请求报文是由三部分组成: **请求行**, **请求报头**和**请求正文**。

#### 请求行

```css
eg: GET index.html HTTP/1.1
```

#### 请求报头

```css
Accept, Accept-Charset, Accept-Encoding, Accept-Language, Content-Type, Authorization, Cookie, User-Agent
```

#### 请求正文

就是传入的参数，比如json这时就需要设置Content-Type: application/json。



## 4. 服务器处理请求并返回HTTP报文

HTTP响应报文也是由三部分组成: **状态码**, **响应报头**和**响应报文**。

#### 状态码

状态码是由3位数组成，第一个数字定义了响应的类别，且有五种可能取值:

- 1xx：指示信息–表示请求已接收，继续处理。
- 2xx：成功–表示请求已被成功接收、理解、接受。
- 3xx：重定向–要完成请求必须进行更进一步的操作。
- 4xx：客户端错误–请求有语法错误或请求无法实现。
- 5xx：服务器端错误–服务器未能实现合法的请求。
  平时遇到比较常见的状态码有:200, 204, 301, 302, 304, 400, 401, 403, 404, 422, 500(分别表示什么请自行查找)。
  - 301和302有什么区别？
  - HTTP缓存

| HTTP 状态码 | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| 301         | 代表永久性转移，搜索引擎在抓取新内容的同时也将旧的网址替换为重定向之后的网址。 |
| 适用        | 301换域名，应该使用（res.redirect(301,newUrl)）              |
| 302         | 代表暂时性转移，，搜索引擎会抓取新的内容而保留旧的网址。会出现网络劫持，尽量用301,否则会被认为是故意提高排名的非法请求 |
| 400         | 错误的请求。                                                 |
| 401         | 访问被拒绝。IIS 定义了几个不同的 401 错误，用于指示更为具体的错误原因。这些具体的错误代码在浏览器中显示，但不在 IIS 日志中显示。详见 [401 状态码](https://cloud.tencent.com/document/product/302/19903#401)。 |
| 403         | 禁止访问。如果网站没有设置默认文档，并且没有设置为允许目录浏览，则会收到这个一般 403 状态代码。IIS 定义了几个不同的 403 错误，用于指示更为具体的错误原因，详见 [403 状态码](https://cloud.tencent.com/document/product/302/19903#403)。 |
| 404         | 未找到。发生此错误的原因是您试图访问的文件已被移走或删除。如果在安装 URLScan 工具之后，试图访问带有有限扩展名的文件，也会发生此错误。如果您安装了 URIScan 工具，则会在 w3svc 日志文件中看到“Rejected by URLScan”。这种情况下，该请求的日志文件项中将出现“Rejected by URLScan”的字样。IIS 定义了几个不同的 404 错误，用于指示更为具体的错误原因，详见 [404 状态码](https://cloud.tencent.com/document/product/302/19903#404)。 |
|500|服务器错误|
**301、302RUL劫持的理解：**

 网站A（网站比较烂）上做了一个302跳转到网站B（搜索排名很靠前），这时候有时搜索引擎会使用网站B的内容，但却收录了网站A的地址，这样在不知不觉间，网站B在为网站A作贡献，网站A的排名就靠前了。



#### 响应报头

常见的响应报头字段有: Server, Connection...。

#### 响应报文

服务器返回给浏览器的文本信息，通常HTML, CSS, JS, 图片等文件就放在这一部分。

## 5. 浏览器解析渲染页面

浏览器是一个边解析边渲染的过程。

1. 首先浏览器解析HTML文件构建DOM树，
2. 然后解析CSS文件构建渲染树
3. 等到渲染树构建完成后，浏览器开始布局渲染树并将其绘制到屏幕上

## 6.连接结束，怎么优化？

1. 资源不从网络获取，放到浏览器里面缓存
2. 必须从网络获取的，考虑缩短连接时间，即DNS优化
3. 减少相应内容，比如说进行压缩